& /0000

BATCH >
DUMPER <
DUMP_INI <
DUMP_TAM <
DUMP_UL <
DUMP_BL <
DUMP_EXE <
CHTOUI <
CHTOUI_1 <
CHTOUI_2 <

; Lista para salvar os getdatas
BATCH_GD_LIST $ =0
	JP BATCH_GD_INI1
	JP /0000

; Cosntantes
BATCH_CONST_2  K /2
BATCH_CONST_LD K /8000
BATCH_CONST_GD K /D300
BATCH_CONST_MM K /9000

; 
BATCH_CONST_SLASHSLASH K /2F2F
BATCH_CONST_JB         K /4A42
BATCH_CONST_EOL        K /0D0A
BATCH_CONST_DU         K /4455
BATCH_CONST_LO         K /4C4F
BATCH_CONST_SLASHSTAR  K /2F2A
BATCH_CONST_BB         K /2020

;=======================================
; Função para executar o batch
;=======================================
; Variáveis
BATCH_UL K /0000
BATCH_VAR_TMP K /0000
BATCH_VAR_WORD1 K /0000
BATCH_VAR_WORD2 K /0000
BATCH_VAR_CMD K /0000
; Função de batch
BATCH K /0000
	
	; Cria a lista de instruções GD
	LD BATCH_UL
	+  BATCH_CONST_GD
	MM BATCH_GD_INI1
	MM BATCH_GD_INI2
	MM BATCH_GD_INIEOL
	MM BATCH_GD_CMD1
	MM BATCH_GD_CMD2
	MM BATCH_GD_CMDEOL
	MM BATCH_GD_DU_BL1
	MM BATCH_GD_DU_BL2
	MM BATCH_GD_DU_INI1
	MM BATCH_GD_DU_INI2
	MM BATCH_GD_DU_TAM1
	MM BATCH_GD_DU_TAM2
	MM BATCH_GD_DU_EXE1
	MM BATCH_GD_DU_EXE2
	MM BATCH_GD_DU_UL
	MM BATCH_GD_DU_BB1
	MM BATCH_GD_DU_BB2
	MM BATCH_GD_DU_BB3
	MM BATCH_GD_DU_BB4
	MM BATCH_GD_DU_EOL

;------------------------------
; Lê o //JB
;------------------------------
BATCH_READ_INI1 $ =0
	BATCH_GD_INI1 K /0000
	- BATCH_CONST_SLASHSLASH
	JZ BATCH_READ_INI2
	LV /001
	JP BATCH_ERROR

BATCH_READ_INI2 $ =0
	BATCH_GD_INI2 K /0000
	- BATCH_CONST_JB
	JZ BATCH_READ_INIEOL
	LV /001
	JP BATCH_ERROR
BATCH_READ_INIEOL $ =0
	BATCH_GD_INIEOL K /0000
	- BATCH_CONST_EOL
	JZ BATCH_READ_INIEND
	LV /001
	JP BATCH_ERROR
BATCH_READ_INIEND $ =0

;------------------------------
; Lê o Comando
;------------------------------
BATCH_READ_CMD1 $ =0
	BATCH_GD_CMD1 K /0000
	MM BATCH_VAR_TMP
	- BATCH_CONST_SLASHSLASH
	JZ BATCH_READ_CMD2
	LD BATCH_VAR_TMP
	- BATCH_CONST_SLASHSTAR
	JZ BATCH_READ_END
	LV /002
	JP BATCH_ERROR

BATCH_READ_CMD2 $ =0
	BATCH_GD_CMD2 K /0000
	MM BATCH_VAR_CMD
	- BATCH_CONST_DU
	JZ BATCH_READ_CMDEOL
	LD BATCH_VAR_CMD
	- BATCH_CONST_LO
	JZ BATCH_READ_CMDEOL
	LV /002
	JP BATCH_ERROR

BATCH_READ_CMDEOL $ =0
	BATCH_GD_CMDEOL K /0000
	- BATCH_CONST_EOL
	JZ BATCH_READ_CMDEND
	LV /002
	JP BATCH_ERROR
BATCH_READ_CMDEND $ =0

;------------------------------
; Processa o comando.
;------------------------------
	LD BATCH_VAR_CMD
    - BATCH_CONST_DU
	JZ BATCH_READ_CMD_DU
	LD BATCH_VAR_CMD
	- BATCH_CONST_LO
	JZ BATCH_READ_CMD_LO
	LV /002
	JP BATCH_ERROR

; Comando DU
BATCH_READ_CMD_DU $ =0

BATCH_READ_CMD_DU_BL $ =0
	BATCH_GD_DU_BL1 K /0000
	MM BATCH_VAR_WORD1
	BATCH_GD_DU_BL2 K /0000
	MM BATCH_VAR_WORD2
	LV BATCH_VAR_WORD1
	MM CHTOUI_1
	LV BATCH_VAR_WORD2
	MM CHTOUI_2
	SC CHTOUI
	MM DUMP_BL

	BATCH_GD_DU_BB1 K /0000
	- BATCH_CONST_BB
	JZ BATCH_READ_CMD_DU_INI
	LV /003
	JP BATCH_ERROR


BATCH_READ_CMD_DU_INI $ =0
	BATCH_GD_DU_INI1 K /0000
	MM BATCH_VAR_WORD1
	BATCH_GD_DU_INI2 K /0000
	MM BATCH_VAR_WORD2
	LV BATCH_VAR_WORD1
	MM CHTOUI_1
	LV BATCH_VAR_WORD2
	MM CHTOUI_2
	SC CHTOUI
	MM DUMP_INI

	BATCH_GD_DU_BB2 K /0000
	- BATCH_CONST_BB
	JZ BATCH_READ_CMD_DU_TAM
	LV /003
	JP BATCH_ERROR

BATCH_READ_CMD_DU_TAM $ =0
	BATCH_GD_DU_TAM1 K /0000
	MM BATCH_VAR_WORD1
	BATCH_GD_DU_TAM2 K /0000
	MM BATCH_VAR_WORD2
	LV BATCH_VAR_WORD1
	MM CHTOUI_1
	LV BATCH_VAR_WORD2
	MM CHTOUI_2
	SC CHTOUI
	MM DUMP_TAM

	BATCH_GD_DU_BB3 K /0000
	- BATCH_CONST_BB
	JZ BATCH_READ_CMD_DU_EXE
	LV /003
	JP BATCH_ERROR

BATCH_READ_CMD_DU_EXE $ =0
	BATCH_GD_DU_EXE1 K /0000
	MM BATCH_VAR_WORD1
	BATCH_GD_DU_EXE2 K /0000
	MM BATCH_VAR_WORD2
	LV BATCH_VAR_WORD1
	MM CHTOUI_1
	LV BATCH_VAR_WORD2
	MM CHTOUI_2
	SC CHTOUI
	MM DUMP_EXE

	BATCH_GD_DU_BB4 K /0000
	- BATCH_CONST_BB
	JZ BATCH_READ_CMD_DU_UL
	LV /003
	JP BATCH_ERROR

BATCH_READ_CMD_DU_UL $ =0
	LV /000
	MM BATCH_VAR_WORD1
	BATCH_GD_DU_UL K /0000
	MM BATCH_VAR_WORD2
	LV BATCH_VAR_WORD1
	MM CHTOUI_1
	LV BATCH_VAR_WORD2
	MM CHTOUI_2
	SC CHTOUI
	MM DUMP_UL

	BATCH_GD_DU_EOL K /0000
	- BATCH_CONST_EOL
	JZ BATCH_READ_CMD_DU_DUMP
	LV /003
	JP BATCH_ERROR

BATCH_READ_CMD_DU_DUMP $ =0
	SC DUMPER
	HM BATCH

; Comando LO
BATCH_READ_CMD_LO $ =0

OS /0EE
	
; Processa o inicio do batch
BATCH_ERROR $ =0
	OS /0EE
	JP BATCH_END

; Terminou a leitura
BATCH_READ_END $ =0
BATCH_END $ =0
	RS BATCH

# BATCH